#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <fcntl.h>
#include "../../../../ex08/ft_ten_queens_puzzle.c"
#include "../../../utils/constants.h"

typedef struct s_test
{
	char *desc;
	int expected;
	char * expected_output;
} t_test;

int run_tests(t_test *tests, int count);

int main(void)
{
	t_test tests[] = {
		{
			.desc = "Ten Queen ",
			.expected = 724,
			.expected_output = "0257948136\n0258693147\n0258693174\n0286931475\n0358297146\n0369184275\n0369281475\n0369581427\n0369714258\n0369724815\n0369741825\n0384792516\n0386192574\n0386925147\n0396824175\n0461973825\n0469318257\n0471692853\n0479261358\n0479631852\n0495813627\n0536928147\n0536971428\n0538629147\n0539682417\n0571682493\n0572681493\n0574182963\n0579382461\n0582731946\n0582963147\n0584973162\n0586137942\n0592683147\n0615793824\n0635819427\n0639714258\n0641792853\n0647185293\n0681592473\n0681742953\n0682713594\n0685297413\n0695184273\n0716824935\n0716924835\n0718529364\n0736814952\n0736815924\n0738629514\n0741829635\n0751693842\n0751863924\n0752813964\n0752814936\n0758293641\n0796318524\n0849731625\n0851692473\n0852974136\n0861379425\n0862714953\n0946827135\n0964718253\n1357902468\n1372859064\n1379485026\n1386490572\n1396852074\n1460958273\n1463928570\n1468370259\n1470692538\n1473692058\n1475296038\n1475820369\n1475820639\n1479258036\n1480936275\n1483975206\n1497036258\n1526908473\n1526974038\n1529748306\n1572084936\n1572639084\n1580742963\n1586902473\n1592683047\n1642839750\n1647039258\n1682793504\n1693074258\n1695084273\n1695203748\n1728649053\n1748059263\n1758203649\n1792853064\n1793048526\n1807429635\n1827935046\n1829630475\n1849035726\n1850296374\n1852930746\n1857902463\n1862974035\n1869304752\n1926830475\n1963028574\n1972480536\n2058497316\n2417963085\n2418596307\n2469350817\n2470831695\n2471860359\n2480596137\n2481963075\n2483097516\n2483591607\n2483961570\n2497316850\n2519084736\n2539084716\n2570369184\n2574039681\n2579084136\n2579304186\n2580369147\n2580369714\n2580731649\n2580946137\n2581369704\n2581369740\n2581703649\n2584703169\n2586031479\n2586137049\n2586307149\n2594186307\n2594186370\n2596137048\n2613794850\n2617509483\n2619753804\n2683049157\n2683509147\n2693804175\n2716094853\n2736814059\n2750814639\n2750946831\n2751840396\n2751940386\n2758094613\n2758140369\n2790514683\n2793804615\n2817469053\n2819460357\n2857130649\n2859160374\n2918530746\n2936815704\n2938046157\n2951840736\n2951863704\n2961307485\n2963041857\n2963185047\n2964085713\n2968041753\n2970415863\n2971386405\n2974130685\n3047926815\n3068174295\n3069518427\n3075196824\n3079152864\n3147925860\n3148097526\n3164908572\n3168520974\n3169508427\n3172864905\n3174805926\n3175804692\n3179025864\n3179625804\n3184975206\n3185297046\n3185960247\n3195847026\n3508627149\n3509468271\n3509647182\n3528174690\n3529168074\n3529607418\n3529641807\n3571408692\n3579162084\n3579168024\n3582071469\n3582961740\n3582971460\n3584902716\n3584906172\n3592074186\n3592471860\n3594172680\n3594602718\n3605197248\n3605817429\n3625190847\n3629508471\n3629518407\n3642097581\n3649157208\n3681470295\n3681502479\n3685140792\n3685190247\n3685207419\n3691470258\n3692470815\n3692470851\n3692814750\n3704815926\n3704915286\n3708146925\n3708516924\n3724690518\n3724805916\n3724805961\n3724815960\n3724908516\n3728590641\n3728690514\n3741596028\n3741906825\n3742091586\n3742096851\n3742951860\n3742961580\n3748091526\n3748096251\n3792514086\n3794150268\n3804915726\n3825190647\n3827905146\n3829164075\n3841905726\n3842096157\n3847025169\n3849057162\n3862051497\n3864150972\n3908526174\n3925817460\n3941862750\n3942861750\n3961520748\n3964170285\n3974205186\n3974206158\n4038619257\n4053972861\n4073681592\n4075186392\n4075281396\n4079258136\n4079631852\n4083579162\n4085269713\n4138279605\n4139680275\n4139685207\n4150968273\n4152968307\n4159268370\n4179285306\n4179620835\n4179630852\n4180279635\n4196302857\n4208619753\n4209683175\n4258136970\n4258170369\n4258603179\n4259613708\n4259630718\n4273609158\n4275180369\n4279130685\n4283179605\n4283975160\n4285713069\n4285916037\n4286130975\n4286915703\n4293681570\n4295186370\n4295380716\n4296158073\n4296308157\n4603582971\n4605713829\n4609582731\n4615703829\n4619703825\n4619730285\n4630279185\n4630718529\n4630752918\n4639258170\n4680279135\n4682519703\n4682713509\n4682730915\n4683179205\n4685209713\n4693182570\n4695207318\n4702586931\n4703581926\n4708619253\n4713908526\n4713968520\n4716208359\n4716258093\n4716920835\n4718520369\n4730286915\n4730619582\n4736920581\n4738620519\n4750268319\n4752916830\n4758203691\n4790258613\n4802619753\n4803179625\n4809362751\n4809627135\n4813702596\n4815720369\n4819257036\n4819630752\n4835916027\n4905317286\n4930271685\n4930286175\n4938271605\n4953168207\n4953172860\n4970286135\n5029713864\n5046827139\n5046831792\n5061728394\n5069713824\n5069728314\n5094682713\n5164083972\n5180369247\n5180742963\n5184279630\n5186297403\n5190372864\n5190637248\n5196820374\n5197380246\n5209741386\n5241796308\n5247083169\n5249731680\n5261379480\n5263079418\n5269380417\n5269713084\n5281479630\n5283079164\n5283741906\n5283791640\n5286031479\n5286091473\n5291380746\n5296418073\n5297413068\n5304792681\n5306817429\n5314790286\n5316820794\n5317269084\n5317286490\n5317480296\n5319720864\n5360741829\n5369247081\n5369281470\n5369720814\n5380269714\n5380296174\n5384296170\n5390417268\n5394286170\n5396417028\n5703691842\n5703841926\n5704619283\n5704813629\n5706318429\n5713084296\n5713869024\n5714083962\n5714286930\n5716024839\n5716820394\n5720869314\n5724819630\n5726390841\n5740369281\n5740386291\n5741396820\n5741829630\n5741863029\n5790316824\n5791380246\n5803697142\n5819720364\n5820369147\n5820379164\n5820714693\n5840731629\n5847031692\n5849031726\n5860314792\n5860319724\n5861720394\n5914730286\n5916420837\n5920368147\n5920741863\n5924718603\n5924813607\n5926318407\n5946027138\n5961380742\n6025793841\n6025794813\n6035829714\n6038479251\n6057138249\n6058137249\n6074182539\n6091473825\n6135849027\n6137948502\n6150942837\n6152974830\n6157903842\n6158094273\n6170835924\n6172094853\n6174809352\n6195084273\n6205849731\n6207485913\n6251903748\n6251908473\n6257038419\n6257048139\n6257903148\n6257908413\n6258093174\n6258403971\n6271309485\n6271409358\n6275091483\n6275184039\n6275194038\n6275194083\n6275309481\n6291483075\n6291853074\n6295084713\n6295184073\n6307185249\n6307529148\n6307529184\n6308529741\n6314792580\n6314809752\n6314859207\n6318497520\n6318529704\n6350842791\n6357902418\n6370481592\n6370491528\n6374809152\n6394182570\n6394802751\n6405397281\n6405827319\n6407528139\n6407925813\n6415093827\n6415097283\n6417028539\n6417038259\n6417928530\n6420831975\n6420837915\n6428591307\n6470358192\n6470392581\n6470831925\n6471825309\n6490352817\n6490531728\n6491372850\n6804152973\n6814039752\n6814702953\n6815024793\n6820374195\n6820974135\n6824195307\n6825194073\n6827135094\n6830491572\n6831479025\n6835091427\n6851902473\n6852074139\n6920847135\n6924803175\n6930481572\n6931825704\n6952073184\n7025869314\n7028613594\n7029584136\n7031958246\n7035914286\n7036814952\n7036958142\n7038692514\n7048136295\n7048159263\n7061953842\n7063184295\n7081469253\n7140839625\n7142869350\n7180539642\n7182530946\n7206195384\n7209485316\n7241859630\n7241905386\n7248059613\n7248159603\n7249053168\n7249185360\n7263185940\n7283905146\n7306195824\n7316490852\n7316950842\n7380246195\n7382490516\n7386205149\n7403862951\n7405813629\n7405813692\n7413692850\n7413862950\n7413968520\n7415296830\n7418296350\n7418630259\n7418630295\n7419053862\n7419268350\n7419630285\n7419630852\n7420695813\n7420915863\n7425960318\n7429630815\n7460915283\n7480915263\n7502683149\n7516038429\n7516408392\n7516902483\n7518036924\n7519403862\n7528139640\n7529168304\n7530649182\n7581403692\n7582036914\n7941502683\n8027519463\n8036971425\n8073169524\n8130695247\n8137025964\n8142097536\n8147069253\n8149703625\n8150964273\n8170369524\n8172064953\n8192570364\n8206951473\n8207146935\n8241796350\n8251940736\n8271350946\n8304796251\n8304915726\n8306925741\n8317206495\n8352960741\n8357160249\n8407316952\n8413097526\n8419257036\n8427360915\n8427915063\n8470251693\n8473025961\n8473091526\n8502963741\n8516024793\n8519063724\n8520741963\n8524179360\n8524179630\n8524703961\n8526307941\n8529307461\n8531629740\n8536071429\n8539041726\n8603147925\n8613509427\n8620514973\n8627140935\n8642097531\n9035281746\n9053172864\n9137285046\n9138620574\n9147025863\n9148307526\n9150268374\n9203681475\n9241706358\n9247185063\n9247186035\n9248136075\n9248306157\n9258170364\n9261370485\n9263184075\n9263185047\n9281470635\n9283075164\n9283175064\n9304815726\n9314702586\n9317286405\n9318257046\n9318407526\n9352814706\n9358207146\n9360285741\n9364180572\n9384206175\n9407316852\n9413862057\n9415026837\n9417036852\n9417268053\n9420617538\n9425817036\n9427318506\n9428317506\n9460317582\n9461370852\n9463028571\n9463071852\n9504186372\n9520368147\n9520738641\n9528307146\n9530681742\n9538026174\n9603175824\n9613074852\n9613807425\n9615207483\n9630258174\n9630275184\n9630285741\n9630418572\n9630718524\n9630815724\n9641702853\n9713068524\n9741306825\n9741306852\n9742051863\n",
		},
	};
	int count = sizeof(tests) / sizeof(tests[0]);

	return run_tests(tests, count);
}

int run_tests(t_test *tests, int count)
{
	int i;
	int error = 0;

	for (i = 0; i < count; i++)
	{
		// Flush the standard output buffer
		fflush(stdout);

		char buffer[8024];
		// Clear the buffer used to capture the output of the function being tested
		memset(buffer, 0, sizeof(buffer));

		// Redirect the output to a file
		int saved_stdout = dup(STDOUT_FILENO);
		int output_fd = open("output.txt", O_WRONLY | O_CREAT | O_TRUNC, S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH);
		dup2(output_fd, STDOUT_FILENO);
		close(output_fd);

		// Call the function to be tested
		int result = ft_ten_queens_puzzle();

		// Restore the original output
		fflush(stdout);
		dup2(saved_stdout, STDOUT_FILENO);
		close(saved_stdout);


		// Open the output file and check its contents
		FILE *fp = fopen("output.txt", "rt");

		int line = 0;

		while(fgets(buffer + 11*line, sizeof(buffer), fp) != NULL)
		{
			line++;
		}

		fclose(fp);

		int test_return = result == tests[i].expected  ;
		int test_output =  strcmp(buffer, tests[i].expected_output)  == 0;  

		if (!test_return || !test_output)
		{
			if(test_return)
			{

				printf(RED"\t[%d] %s\n\t" GREEN CHECKMARK GREY " Return : Expected %d, got %d\n", i + 1, tests[i].desc, tests[i].expected, result);
			}
			else{
				printf("\t" RED "[%d] %s\n\t  Return : Expected %d, got %d\n", i + 1, tests[i].desc, tests[i].expected, result);
			}

			if(test_output){
				printf("\t" GREEN CHECKMARK GREY " Output : Valid\n");
			}
			else{
				printf("\t" RED "  Output : Invalid\n");
			}
			error -= 1;
		}
		else
	{
			printf("  " GREEN CHECKMARK GREY " [%d] %s\n\t" GREEN CHECKMARK GREY " Return : Expected %d, got %d\n\t"GREEN CHECKMARK GREY" Output : Valid\n" DEFAULT, i + 1, tests[i].desc, tests[i].expected, result);
		}
	}

	return error;
}
